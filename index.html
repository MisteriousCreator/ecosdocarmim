<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ecos do Carmim: Um Enigma C√°rmico com Tarot</title>

<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg-color:#f7f3e8;
    --text-color:#3f2f22;
    --border-color:#b2996e;
    --accent:#8b0000;
    --card:#fffcf0;
    --muted:#796d5f;
    font-size:15px;
  }
  html,body{height:100%;margin:0;background:var(--bg-color);color:var(--text-color);font-family:'Cormorant Garamond',serif;-webkit-font-smoothing:antialiased}
  .wrap{max-width:480px;margin:14px auto;padding:12px;box-sizing:border-box}
  .card{background:var(--card);border:3px solid var(--border-color);border-radius:12px;padding:14px;box-shadow:0 8px 20px rgba(0,0,0,.12);margin-bottom:14px}
  h1{font-family:'Playfair Display',serif;font-size:1.4rem;margin:0 0 6px;text-align:center;color:var(--accent);border-bottom:2px dashed var(--border-color);padding-bottom:8px}
  .lead{margin:0 0 12px;font-size:.95rem;text-align:center;font-style:italic;color:var(--muted)}
  .steps{display:flex;gap:8px;justify-content:center;margin:10px 0}
  .step{width:28px;height:44px;border:2px solid var(--border-color);border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--border-color);background:var(--card)}
  .step.done{background:var(--accent);color:#fff;border-color:transparent;transform:translateY(-3px)}
  .enigma{font-size:1rem;line-height:1.4;padding:10px;border-left:4px solid var(--accent);background:rgba(255,255,255,0.5);border-radius:6px}
  .clue-box{background:#f0eae1;padding:10px;border-radius:8px;margin-top:10px;border:1px dashed var(--border-color)}
  .visual-clue {text-align:center;margin-top:10px}
  .visual-clue img{max-width:100%;border-radius:6px;box-shadow:0 6px 18px rgba(0,0,0,.12)}
  .controls{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
  input[type="text"]{width:100%;padding:12px;border-radius:8px;border:1px solid var(--border-color);background:var(--card);font-size:1rem;color:var(--text-color);box-sizing:border-box}
  .btn{flex:1;min-width:120px;padding:12px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.12)}
  .btn.ghost{background:transparent;border:1px solid var(--border-color);color:var(--text-color);box-shadow:none}
  .hint{margin-top:10px;color:var(--accent);font-style:italic}
  .log{margin-top:12px;padding:8px;border-radius:8px;background:var(--card);border:1px solid var(--border-color);text-align:center;color:var(--muted)}
  .small{font-size:.88rem;color:var(--muted)}
  .seq-btn{padding:10px;border-radius:6px;border:1px solid var(--border-color);background:var(--card);margin:6px;min-width:90px}
  .seq-btn.correct{background:var(--accent);color:white;border-color:transparent}
  @media(min-width:700px){.wrap{max-width:720px;padding:20px}h1{font-size:1.8rem}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Ecos do Carmim: Um Enigma C√°rmico</h1>
      <p class="lead">Um caderninho digital m√≠stico: siga as pistas, anote se necess√°rio, e reconstrua mem√≥rias com tarot e amor carmico.</p>

      <div class="steps" id="steps">
        <div class="step" data-i="0">I</div>
        <div class="step" data-i="1">II</div>
        <div class="step" data-i="2">III</div>
        <div class="step" data-i="3">IV</div>
        <div class="step" data-i="4">V</div>
      </div>

      <div id="stageArea"></div>

      <div class="log" id="logArea">
        <span id="timer">Tempo: 0s</span> ‚Äî <span id="status">Tentativas: 0 ‚Ä¢ Pistas: 0</span>
      </div>
    </div>
  </div>

<script>
/* === CONFIG: respostas (em min√∫sculas, sem acentos) === */
const answers = {
  level1: "olhares",
  level2: "outravida",
  level3: "carmim",
  level4: "prometidos",
  level5: "eternidade"
};

/* === N√≠veis modulares com tarot e misticismo === */
const levels = [
  {
    id: 1,
    title: "N√≠vel I ‚Äî Mem√≥ria de Ferro",
    clue: "No calor da forja, onde o metal ganha forma, um olhar trocado na festa selou nosso destino. Mas o tempo infectou as mem√≥rias... ajuste o brilho do fogo (contraste e invers√£o) pra revelar a palavra que nos uniu primeiro. Anote no caderninho.",
    type: "image",
    media: "media/forja.jpeg", // atualize a imagem pra esconder "olhares" melhor
    placeholder: "palavra (min√∫sculas)",
    answer: answers.level1,
    hint: "O fogo da forja revela segredos quando invertido... como um olhar que transcende vidas."
  },
  {
    id: 2,
    title: "N√≠vel II ‚Äî O Conto da F√™nix",
    clue: "As cartas que trocamos por 2 anos eram como chamas que n√£o se apagam. No bilhete chamuscado do ferreiro, as primeiras centelhas de cada verso revelam o que nos espera al√©m desta vida. Alinhe as iniciais e descubra a frase (sem espa√ßos).<br><br><i>O √∫ltimo suspiro guardei neste papiro.<br>Um fogo que n√£o consome, mas transforma.<br>Todo fim √© renascimento, minha amada.<br>Renas√ßa das cinzas, como a f√™nix carmesim.<br>Aperda forja asas pra voar novamente.<br>Vida que arde n√£o morre, apenas evolui.<br>Infectado pelo destino, eu parti cedo.<br>Deixe o carmim ecoar e nos reencontrar.<br>Apromesa selada no vermelho do amor.</i>",
    type: "inpage",
    placeholder: "frase (sem espa√ßos, min√∫sculas)",
    answer: answers.level2,
    hint: "Comece pelo in√≠cio de cada linha... assim como as cartas que come√ßaram tudo."
  },
  {
    id: 3,
    title: "N√≠vel III ‚Äî O Di√°rio da Nobre",
    clue: "Aos 25 anos, a nobre escreveu seu lamento nas p√°ginas, culpando-se pela infec√ß√£o que levou o ferreiro. O que buscamos est√° no in√≠cio e no fim de cada par√°grafo principal... o carmim que tinge nossa hist√≥ria se revela ali. (concatene as iniciais com os finais para formar a palavra)",
    type: "pdf",
    media: "media/diario.pdf", // atualize com o novo PDF gerado
    placeholder: "palavra (min√∫sculas)",
    answer: answers.level3,
    hint: "In√≠cio de cada par√°grafo para a primeira metade, fim (√∫ltima letra da √∫ltima palavra) para a segunda... como o ciclo de vidas que nos une."
  },
  {
    id: 4,
    title: "N√≠vel IV ‚Äî O Julgamento dos Sete",
    clue: "Nos sete selos do di√°rio, palavras ocultas esperam. Desloque cada centelha pelo n√∫mero de anos que nossas cartas duraram (como o acidente deslocou meu destino). O c√≥digo: NPMKCRGBMQ. Revele a promessa.<br><br><strong>Dica:</strong> √â uma cifra de substitui√ß√£o onde letras se movem no alfabeto. Encontre o deslocamento na nossa hist√≥ria.",
    type: "inpage",
    placeholder: "frase (sem espa√ßos, min√∫sculas)",
    answer: answers.level4,
    hint: "As letras se movem pelo mesmo numero de anos da nossa hist√≥ria da vida passada... ROT2."
  },
  {
    id: 5,
    title: "N√≠vel V ‚Äî A Carta do √öltimo Sussurro",
    clue: "Esta carta, escrita nas sombras do di√°rio, carrega meu √∫ltimo sussurro. As mem√≥rias que guardaste ‚Äì 'olhares', 'outravida', 'carmim', 'prometidos' ‚Äì s√£o as chaves pra revelar minha promessa final. Olha as linhas com cuidado! Junte os ecos da nossa hist√≥ria pra encontrar a palavra que nos une al√©m da vida.<br><br><p>Meu amado, o *olhares* que trocamos na festa ainda brilha em mim. Foi o in√≠cio de tudo, um momento que o destino guardou. As *outravida* que sonhei contigo me sustentaram na solid√£o. O carmim do fogo da forja e do sangue que te levou me marcou pra sempre. Fui *prometidos* a outro, mas meu cora√ß√£o te escolheu.</p><p>Escrevi-te cartas que o vento levou, cada uma um *olhares* preso no papel. A *outravida* nos chama, um ciclo al√©m da morte. O carmim arde em minhas veias, lembran√ßa viva de ti. Fui *prometidos* ao sil√™ncio, mas te prometo eternidade.</p><p>Se a forja me roubou de ti, que o amor nos traga de volta. Teu *olhares* foi minha luz, a *outravida* minha esperan√ßa. O carmim que carrego √© teu eco. Fui *prometidos* ao passado, mas a palavra final vive nas linhas ‚Äì descobre-a com teu cora√ß√£o.</p>",
    type: "inpage",
    placeholder: "palavra final (min√∫sculas)",
    answer: answers.level5,
    hint: "Segue a ordem da nossa hist√≥ria: festa, cartas, forja, culpa. Pega a primeira letra palavra destacada (italico ou negrito) que encontrar√°s as chaves meu amor :3."
  }
// No HTML: mude os seq-btn pra data-arc="festa">üéâ Festa</button> etc.
];

/* === Estado === */
let cur = 0, attempts = 0, hints = 0, elapsed = 0, timerInt = null, seqOrder = [];

/* UTIL: normaliza strings */
function norm(s){
  if(!s) return "";
  return s.normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,'').toLowerCase();
}

/* RENDER com mensagens pessoais e debug */
function render(){
  console.log('Rendering level ' + cur); // Debug: Verifique no console se executa
  const lvl = levels[cur];
  if(!lvl) return onComplete();
  updateSteps();

  let html = `<div class="enigma"><strong>${lvl.title}</strong><br>${lvl.clue}</div>`;
  if(lvl.type === 'image'){
    html += `<div class="clue-box"><div class="visual-clue"><img id="clueImg" src="${lvl.media}" alt="Imagem do enigma"></div>
             <p class="small">Ajuste brilho para revelar (ou baixe).</p></div>`;
  } else if(lvl.type === 'pdf'){
    html += `<div class="clue-box"><p class="small">Abra o PDF e explore a grade.</p>
             <p style="text-align:center"><a class="btn ghost" href="${lvl.media}" target="_blank">Abrir Di√°rio</a></p></div>`;
  } else if(lvl.type === 'sequence'){
    html += `<div class="clue-box"><p class="small">Toque na ordem certa.</p>
             <div style="display:flex;flex-wrap:wrap;justify-content:center">
               <button class="seq-btn" data-arc="roda">üõû Roda</button>
               <button class="seq-btn" data-arc="diabo">üòà Diabo</button>
               <button class="seq-btn" data-arc="carruagem">üöÄ Carruagem</button>
               <button class="seq-btn" data-arc="carruagem">üöÄ Carruagem</button>
             </div>
             <p id="seqMsg" class="hint"></p></div>`;
  }

  html += `<label class="small">Resposta</label>
           <input id="answerInput" placeholder="${lvl.placeholder}" autocomplete="off" autocapitalize="none" spellcheck="false" />
           <div class="controls"><button class="btn" id="submitBtn">Conferir</button><button class="btn ghost" id="hintBtn">Pista (+30s)</button></div>
           <p id="result" class="hint"></p>`;

  document.getElementById('stageArea').innerHTML = html;

  document.getElementById('submitBtn').addEventListener('click', onSubmit);
  document.getElementById('hintBtn').addEventListener('click', onHint);
  const inp = document.getElementById('answerInput');
  if (inp) {
    inp.addEventListener('keyup', (e) => { if(e.key === 'Enter') onSubmit(); });
    inp.focus();
  }

  if(lvl.type === 'image' && document.getElementById('clueImg')) {
    document.getElementById('clueImg').addEventListener('click', () => window.open(lvl.media, '_blank'));
  } else if(lvl.type === 'sequence') {
    document.querySelectorAll('.seq-btn').forEach(btn => btn.addEventListener('click', handleSeq));
  }
}

/* SEQUENCE handler atualizado */
function handleSeq(e){
  const arc = e.currentTarget.dataset.arc;
  seqOrder.push(arc);
  e.currentTarget.classList.add('correct');
  const seqMsg = document.getElementById('seqMsg');
  const correct = ['roda','diabo','carruagem'];
  const idx = seqOrder.length - 1;
  if(seqOrder[idx] !== correct[idx]){
    seqMsg.textContent = '‚ùå Errado. Recomece.';
    document.querySelectorAll('.seq-btn').forEach(b=>b.classList.remove('correct'));
    seqOrder = [];
    setTimeout(()=>{ seqMsg.textContent = ''; },1500);
    return;
  }
  if(seqOrder.length === correct.length){
    seqMsg.textContent = '‚úÖ Correto. Sintetize para confirmar.';
  } else {
    seqMsg.textContent = `(${seqOrder.length}/${correct.length}) Acertou.`;
  }
}

/* SUBMIT/HINT */
function onHint(){
  hints++;
  elapsed += 30;
  document.getElementById('result').textContent = 'Sussurro: ' + levels[cur].hint;
  updateLog();
}
function onSubmit(){
  const inp = document.getElementById('answerInput');
  const val = norm(inp ? inp.value : '');
  const correct = norm(levels[cur].answer);
  const res = document.getElementById('result');
  if(!val){ res.textContent = 'Resposta necess√°ria.'; return; }
  attempts++;
  if(val === correct){
    res.textContent = '‚úì Aceita. Avan√ßando...';
    cur++;
    updateLog();
    updateSteps();
    setTimeout(()=>{ if(cur < levels.length) render(); else onComplete(); },900);
  } else {
    res.textContent = '‚úó Tente novamente.';
    updateLog();
  }
}

/* TIMER e init */
function startTimer(){
  if(timerInt) return;
  timerInt = setInterval(()=>{ elapsed++; updateTimer(); },1000);
}
function stopTimer(){ clearInterval(timerInt); timerInt=null; }

function onComplete(){
  stopTimer();
  document.getElementById('stageArea').innerHTML = `<div class="enigma" style="border-left-color:var(--border-color)">
    <strong>Se voc√™ chegou at√© aqui √© por que passou por todos os anos de espera...<br>
    E voc√™ encontrou e decifrou todos os sinais k√°rmicos da nossa rela√ß√£o...<br><br>
    <p style="font-family:'Playfair Display',serif;color:var(--accent);font-size:1.05rem">
      "Ferreiro e Nobre. Carmesim e fogo. A Roda gira, o Diabo tenta, a Carruagem triunfa.<br>
       Obrigado por esperar todos esses s√©culos gatinha..."
    </p>
    <div style="text-align:center">
      <button class="btn" id="restart">Jogar Novamente</button>
    </div>
  </div>`;
  document.getElementById('restart').addEventListener('click', ()=>{ resetAll(); });
  document.getElementById('share').addEventListener('click', ()=> {
    const txt = `Completei Ecos do Carmim ‚Äî promessa selada! ‚ù§Ô∏è`;
    if(navigator.share) navigator.share({title:'Ecos do Carmim', text:txt});
    else alert(txt);
  });
  updateSteps();
}

const steps = document.getElementById('steps');
const timerEl = document.getElementById('timer');
const statusEl = document.getElementById('status');

function updateSteps(){
  document.querySelectorAll('.step').forEach((el, i) => el.classList.toggle('done', i < cur));
}
function updateLog(){ statusEl.textContent = `Tentativas: ${attempts} ‚Ä¢ Pistas: ${hints}`; }
function updateTimer(){ timerEl.textContent = `Tempo: ${elapsed}s`; }

function resetAll(){ cur=0; attempts=0; hints=0; elapsed=0; seqOrder=[]; stopTimer(); render(); updateLog(); updateSteps(); updateTimer(); }

try {
  resetAll(); startTimer();
} catch (error) {
  console.error('Erro ao inicializar: ', error);
}
</script>
</body>
</html>